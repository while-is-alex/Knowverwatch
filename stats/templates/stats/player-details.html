{% extends 'stats/base/base.html' %}
{% load static %}

{% block title %}
    Overwatch League Players
{% endblock %}

{% block css_styles %}
    <link rel="stylesheet" href="{% static 'stats/styles/player-details.css' %}">
    <style>
        .hero-stat.active {
          background-color: {{ player.team.secondary_color }}; /* Change background color for active stat */
          color: {{ player.team.primary_color }};
          border: 2px solid #262626; /* Add border for active stat */
          box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2); /* Add shadow for active stat */
          transform: scale(1.05); /* Apply slight scale for active stat */
          transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s, transform 0.2s; /* Add transition for smooth effect */
        }
    </style>
{% endblock %}

{% block body %}
    <div class="main-content">
        <h1 class="page-title">Player Details</h1>

        <div class="container">
            <span href="{{ player.get_absolute_url }}" class="player-card" style="background-color: {{ player.team.primary_color }}; border: 7px solid {{ player.team.secondary_color }};">
                <img src="{{ player.headshot_url }}" alt="" class="player-headshot">
                <div class="player-name" style="color: {{ player.team.secondary_color }}">{{ player.name }}</div>

                {% if player.role == 'DPS' %}
                    <img src="https://static.wikia.nocookie.net/overwatch/images/1/14/OffenseIcon.png/revision/latest?cb=20160625040759" class="player-role" alt="DPS-role" style="background-color: {{ player.team.secondary_color }}">
                {% elif player.role == 'SUPPORT' %}
                    <img src="https://static.wikia.nocookie.net/overwatch/images/5/5f/SupportIcon.png/revision/latest?cb=20160625042024" class="player-role" alt="support-role" style="background-color: {{ player.team.secondary_color }}">
                {% elif player.role == 'TANK' %}
                    <img src="https://static.wikia.nocookie.net/overwatch/images/6/69/TankIcon.png/revision/latest?cb=20160625041805" class="player-role" alt="tank-role" style="background-color: {{ player.team.secondary_color }}">
                {% endif %}

                <p class="player-first-name" style="color: {{ player.team.secondary_color }}"><strong>First name:</strong> {{ player.first_name }}</p>
                <p class="player-last-name" style="color: {{ player.team.secondary_color }}"><strong>Last name:</strong> {{ player.last_name }}</p>

                {% if player.team %}
                    <a href="{% url 'team-details-page' player.team.slug %}">
                        {% if player.team.name == 'Boston Uprising' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon boston-filter">
                        {% elif player.team.name == 'Hangzhou Spark' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon hangzhou-filter">
                        {% elif player.team.name == 'Houston Outlaws' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon houston-filter">
                        {% elif player.team.name == 'Shanghai Dragons' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon shanghai-filter">
                        {% elif player.team.name == 'New York Excelsior' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon new-york-filter">
                        {% elif player.team.name == 'Toronto Defiant' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon toronto-filter">
                        {% elif player.team.name == 'Twisted Minds' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon twisted-filter">
                        {% elif player.team.name == 'WISP' %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon wisp-filter">
                        {% else %}
                            <img src="{{ player.team.icon }}" alt="team-icon" class="team-icon">
                        {% endif %}
                    </a>
                {% endif %}
            </span>

        </div>

        {% if past_teams %}
            <div class="past-teams">
                <h2>Past teams:</h2>
                {% for team in past_teams %}
                    <a href="{% url 'team-details-page' team.slug %}" class="past-team">
                        <img src="{{ team.logo }}">
                    </a>
                {% endfor %}
            </div>
        {% endif %}

        <h2 class="heroes-title">Heroes:</h2>

        <div class="heroes">

            {% for hero in heroes %}
                <div class="hero-card" style="background-color: {{ player.team.primary_color }}; border: 7px solid {{ player.team.secondary_color }}">

                    {% with 'stats/images/heroes/'|add:hero.0|add:'.png' as path_to_hero_headshot %}
                        <img src="{% static path_to_hero_headshot %}" alt="hero-headshot" class="hero-headshot">
                    {% endwith %}

                    <p class="hero-name" style="color: {{ player.team.secondary_color }}">{{ hero.0 }}</p>

                    <div class="hero-stats-container">

                        <div class="hero-stats">
                            {% for stat in hero.1 %}
                                <div class="hero-stat {% if forloop.first %}active{% endif %}">
                                    <p class="hero-stat-name">{{ stat.name }}:</p>
                                    <p class="hero-stat-value">{{ stat.value }}</p>
                                </div>
                            {% endfor %}
                        </div>

                    </div>

                    <div class="pagination-buttons">
                        <button class="prev-button">←</button>
                        <button class="next-button">→</button>
                    </div>

                </div>
            {% endfor %}

        </div>

    </div>

    <script>
        // Select all the prev and next buttons
        const prevButtons = document.querySelectorAll('.prev-button');
        const nextButtons = document.querySelectorAll('.next-button');

        // Attach event listeners to each set of buttons
        prevButtons.forEach((prevButton, index) => {
            prevButton.addEventListener('click', () => {
                scrollHeroStatsContainer(index, -1);
            });
        });

        nextButtons.forEach((nextButton, index) => {
            nextButton.addEventListener('click', () => {
                scrollHeroStatsContainer(index, 1);
            });
        });

        function scrollHeroStatsContainer(index, direction) {
            const heroStatsContainers = document.querySelectorAll('.hero-stats-container');
            const heroStatsContainer = heroStatsContainers[index];
            const heroStatElements = heroStatsContainer.querySelectorAll('.hero-stat');

            // Find the current active hero-stat
            const activeIndex = Array.from(heroStatElements).findIndex(heroStat => heroStat.classList.contains('active'));

            // Calculate the index of the next hero-stat
            let nextIndex = activeIndex + direction;

            // Ensure the nextIndex is within valid bounds
            if (nextIndex < 0) {
                nextIndex = heroStatElements.length - 1;
            } else if (nextIndex >= heroStatElements.length) {
                nextIndex = 0;
            }

            // Update the active state of hero-stat elements
            heroStatElements[activeIndex].classList.remove('active');
            heroStatElements[nextIndex].classList.add('active');

            // Calculate the new scroll position and update it
            const heroStatWidth = heroStatElements[0].offsetWidth; // Use the width of the first hero-stat
            const margin = 10; // Adjust this value based on your margin
            let newScrollLeft = nextIndex * (heroStatWidth + margin);

            heroStatsContainer.scrollLeft = newScrollLeft;
        }
    </script>

{% endblock %}